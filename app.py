import streamlit as st
import pandas as pd
from datetime import date

st.set_page_config(page_title="تبدیل تومان به تتر", layout="centered")
st.title("💱 ثبت تبدیل تومان به تتر")

# لیست افراد
افراد = ["hassan", "abbas", "shahla", "mohsen"]

# لیست ارزهای دیجیتال
ارزها = ["USDT", "BTC", "ETH", "BNB", "SOL", "XRP", "USDC", "ADA", "DOGE", "DOT"]

# فرم ورود اطلاعات
نام_شخص = st.selectbox("نام شخص", افراد)
تاریخ = st.date_input("تاریخ واریز", value=date.today())
نوع_ارز_واریزی = st.selectbox("نوع ارز واریزی", ["تومان"] + ارزها)

# تعریف اولیه برای مقدار واریز
مقدار_واریز = ""

# مقدار واریز بر اساس نوع ارز
if نوع_ارز_واریزی == "تومان":
    مقدار_واریز = st.text_input("مقدار واریز (تومان)", placeholder="مثلاً 1,000,000")
    try:
        مقدار_واریز_پاک = int(مقدار_واریز.replace(",", ""))
    except:
        مقدار_واریز_پاک = 0
    st.write(f"💰 مقدار وارد شده: {مقدار_واریز} تومان")

elif نوع_ارز_واریزی == "USDT":
    مقدار_واریز_پاک = st.number_input("مقدار واریز (دلار)", min_value=0.0, format="%.2f")
    مقدار_واریز = f"{مقدار_واریز_پاک:.2f}"
    st.write(f"💵 مقدار وارد شده: {مقدار_واریز} دلار")

else:
    مقدار_واریز_پاک = st.number_input(f"مقدار واریز ({نوع_ارز_واریزی})", min_value=0.0, format="%.8f")
    مقدار_واریز = f"{مقدار_واریز_پاک:.8f}"
    st.write(f"🪙 مقدار وارد شده: {مقدار_واریز} {نوع_ارز_واریزی}")

# نمایش واحد کنار مقدار
واحد = "تومان" if نوع_ارز_واریزی == "تومان" else "دلار" if نوع_ارز_واریزی == "USDT" else نوع_ارز_واریزی
st.write(f"مقدار وارد شده: {مقدار_واریز} {واحد}")

# مقدار تتر دریافتی از صرافی
مقدار_تتر = st.number_input("مقدار تتر دریافتی", min_value=0.0, format="%.4f")

# نرخ تبدیل تتر به تومان
نرخ_تتر = st.number_input("💱 نرخ تبدیل تتر به تومان", min_value=0.0, format="%.0f")
st.write(f"🔹 نرخ وارد شده: {نرخ_تتر:,.0f} تومان")

# محاسبه کارمزد پنهان
ارزش_واقعی_تتر = مقدار_تتر * نرخ_تتر
کارمزد_پنهان = مقدار_واریز_پاک - ارزش_واقعی_تتر if مقدار_واریز_پاک > 0 else 0
قیمت_تمام_شده_هر_تتر = مقدار_واریز_پاک / مقدار_تتر if مقدار_تتر > 0 else 0

# دکمه ثبت
if st.button("ثبت تراکنش"):
    st.success("✅ تراکنش ثبت شد")

    st.write("### 📊 جزئیات محاسبه:")
    st.write(f"نام شخص: {نام_شخص}")
    st.write(f"تاریخ: {تاریخ}")
    st.write(f"نوع ارز واریزی: {نوع_ارز_واریزی}")
    st.write(f"مقدار واریز: {مقدار_واریز} {واحد}")
    st.write(f"مقدار تتر دریافتی: {مقدار_تتر}")
    st.write(f"نرخ تبدیل تتر: {نرخ_تتر} تومان")
    st.write(f"ارزش واقعی تتر: {ارزش_واقعی_تتر:,.0f} تومان")
    st.write(f"کارمزد پنهان: {کارمزد_پنهان:,.0f} تومان")
    st.write(f"قیمت تمام‌شده هر تتر: {قیمت_تمام_شده_هر_تتر:,.0f} تومان")

    # ذخیره در دیتافریم
    df = pd.DataFrame([{
        "نام شخص": نام_شخص,
        "تاریخ": تاریخ,
        "نوع ارز": نوع_ارز_واریزی,
        "مقدار واریز": مقدار_واریز_پاک,
        "مقدار تتر": مقدار_تتر,
        "نرخ تتر": نرخ_تتر,
        "کارمزد پنهان": کارمزد_پنهان,
        "قیمت هر تتر": قیمت_تمام_شده_هر_تتر
    }])
    st.write("### 📋 جدول تراکنش:")
    st.dataframe(df)
