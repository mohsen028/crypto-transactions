import streamlit as st
import pandas as pd
from datetime import date

st.set_page_config(page_title="تبدیل تومان به تتر", layout="centered")
st.title("💱 ثبت تبدیل تومان به تتر")

# لیست افراد
افراد = ["hassan", "abbas", "shahla", "mohsen"]

# فرم ورود اطلاعات
نام_شخص = st.selectbox("نام شخص", افراد)
تاریخ = st.date_input("تاریخ واریز", value=date.today())
نوع_ارز_واریزی = st.selectbox("نوع ارز واریزی", ["تومان", "USDT"] + ["BTC", "ETH", "BNB", "SOL", "XRP", "USDC", "ADA", "DOGE", "DOT"])

# مقدار واریز
مقدار_واریز = st.text_input("مقدار واریز", placeholder="مثلاً 1,000,000")
try:
    مقدار_واریز_پاک = int(مقدار_واریز.replace(",", ""))
except:
    مقدار_واریز_پاک = 0

# نمایش واحد کنار مقدار
واحد = "تومان" if نوع_ارز_واریزی == "تومان" else "دلار" if نوع_ارز_واریزی == "تتر" else "ارز"
st.write(f"مقدار وارد شده: {مقدار_واریز} {واحد}")

# مقدار تتر دریافتی از صرافی
مقدار_تتر = st.number_input("مقدار تتر دریافتی", min_value=0.0, format="%.4f")

# نرخ تبدیل تتر به تومان
نرخ_تتر = st.number_input("نرخ تبدیل تتر (تومان)", min_value=0.0)

# محاسبه کارمزد پنهان
ارزش_واقعی_تتر = مقدار_تتر * نرخ_تتر
کارمزد_پنهان = مقدار_واریز_پاک - ارزش_واقعی_تتر if مقدار_واریز_پاک > 0 else 0
قیمت_تمام_شده_هر_تتر = مقدار_واریز_پاک / مقدار_تتر if مقدار_تتر > 0 else 0

# دکمه ثبت
if st.button("ثبت تراکنش"):
    st.success("✅ تراکنش ثبت شد")

    st.write("### 📊 جزئیات محاسبه:")
    st.write(f"نام شخص: {نام_شخص}")
    st.write(f"تاریخ: {تاریخ}")
    st.write(f"نوع ارز واریزی: {نوع_ارز_واریزی}")
    st.write(f"مقدار واریز: {مقدار_واریز} {واحد}")
    st.write(f"مقدار تتر دریافتی: {مقدار_تتر}")
    st.write(f"نرخ تبدیل تتر: {نرخ_تتر} تومان")
    st.write(f"ارزش واقعی تتر: {ارزش_واقعی_تتر:,.0f} تومان")
    st.write(f"کارمزد پنهان: {کارمزد_پنهان:,.0f} تومان")
    st.write(f"قیمت تمام‌شده هر تتر: {قیمت_تمام_شده_هر_تتر:,.0f} تومان")

    # ذخیره در دیتافریم
    df = pd.DataFrame([{
        "نام شخص": نام_شخص,
        "تاریخ": تاریخ,
        "نوع ارز": نوع_ارز_واریزی,
        "مقدار واریز": مقدار_واریز_پاک,
        "مقدار تتر": مقدار_تتر,
        "نرخ تتر": نرخ_تتر,
        "کارمزد پنهان": کارمزد_پنهان,
        "قیمت هر تتر": قیمت_تمام_شده_هر_تتر
    }])
    st.write("### 📋 جدول تراکنش:")
    st.dataframe(df)
