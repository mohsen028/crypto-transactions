import streamlit as st
import pandas as pd
from datetime import date

st.set_page_config(page_title="مدیریت تراکنش‌های ارز دیجیتال", layout="centered")
st.title("📊 ثبت تراکنش مالی")

# لیست افراد و ارزها
افراد = ["hassan", "abbas", "shahla", "mohsen"]
ارزها = ["تومان", "USDT", "BTC", "ETH", "BNB", "SOL", "XRP", "USDC", "ADA", "DOGE", "DOT"]

# انتخاب نوع تراکنش و ارز
نوع_تراکنش = st.selectbox("نوع تراکنش", ["خرید", "فروش", "انتقال", "سواپ"])
ارز_ورودی = st.selectbox("نوع ارز ورودی", ارزها)

# فرم خرید تتر با تومان
if نوع_تراکنش == "خرید" and ارز_ورودی == "تومان":
    st.subheader("💰 خرید تتر با تومان")
    نام_شخص = st.selectbox("نام شخص", افراد)
    تاریخ = st.date_input("تاریخ", value=date.today())
    مقدار_تومان = st.text_input("مقدار واریز (تومان)", placeholder="مثلاً 1,000,000")
    try:
        مقدار_تومان_پاک = int(مقدار_تومان.replace(",", ""))
    except:
        مقدار_تومان_پاک = 0
    مقدار_تتر = st.number_input("مقدار تتر دریافتی", min_value=0.0, format="%.4f")
    نرخ_تتر = st.number_input("نرخ تبدیل تتر به تومان", min_value=0.0, format="%.0f")

    ارزش_واقعی = مقدار_تتر * نرخ_تتر
    کارمزد_پنهان = مقدار_تومان_پاک - ارزش_واقعی if مقدار_تومان_پاک > 0 else 0
    قیمت_هر_تتر = مقدار_تومان_پاک / مقدار_تتر if مقدار_تتر > 0 else 0

    if st.button("ثبت خرید تتر"):
        st.success("✅ خرید ثبت شد")
        st.write(f"نام شخص: {نام_شخص}")
        st.write(f"تاریخ: {تاریخ}")
        st.write(f"مقدار تومان: {مقدار_تومان_پاک:,}")
        st.write(f"مقدار تتر دریافتی: {مقدار_تتر}")
        st.write(f"نرخ تتر: {نرخ_تتر:,} تومان")
        st.write(f"ارزش واقعی تتر: {ارزش_واقعی:,.0f} تومان")
        st.write(f"کارمزد پنهان: {کارمزد_پنهان:,.0f} تومان")
        st.write(f"قیمت تمام‌شده هر تتر: {قیمت_هر_تتر:,.0f} تومان")

# فرم خرید ارز دیجیتال با تتر
elif نوع_تراکنش == "خرید" and ارز_ورودی == "USDT":
    st.subheader("🪙 خرید ارز دیجیتال با تتر")
    نام_شخص = st.selectbox("نام شخص", افراد)
    تاریخ = st.date_input("تاریخ", value=date.today())
    ارز_خروجی = st.selectbox("ارز خریداری‌شده", ارزها[2:])  # فقط ارزهای دیجیتال
    مقدار_تتر_مصرفی = st.number_input("مقدار تتر مصرف‌شده", min_value=0.0, format="%.4f")
    مقدار_ارز_دریافتی = st.number_input(f"مقدار {ارز_خروجی} دریافتی", min_value=0.0, format="%.8f")

    قیمت_هر_واحد = مقدار_تتر_مصرفی / مقدار_ارز_دریافتی if مقدار_ارز_دریافتی > 0 else 0

    if st.button("ثبت خرید ارز"):
        st.success("✅ خرید ارز ثبت شد")
        st.write(f"نام شخص: {نام_شخص}")
        st.write(f"تاریخ: {تاریخ}")
        st.write(f"ارز خریداری‌شده: {ارز_خروجی}")
        st.write(f"مقدار تتر مصرف‌شده: {مقدار_تتر_مصرفی}")
        st.write(f"مقدار ارز دریافتی: {مقدار_ارز_دریافتی}")
        st.write(f"قیمت تمام‌شده هر واحد {ارز_خروجی}: {قیمت_هر_واحد:,.2f} USDT")

# فرم فروش ارز دیجیتال
elif نوع_تراکنش == "فروش":
    st.subheader("💸 فروش ارز دیجیتال")
    نام_شخص = st.selectbox("نام شخص", افراد)
    تاریخ = st.date_input("تاریخ", value=date.today())
    ارز_فروخته_شده = st.selectbox("ارز فروخته‌شده", ارزها[2:])
    مقدار_ارز = st.number_input(f"مقدار {ارز_فروخته_شده} فروخته‌شده", min_value=0.0, format="%.8f")
    مقدار_تتر_دریافتی = st.number_input("مقدار تتر دریافتی", min_value=0.0, format="%.4f")

    قیمت_فروش = مقدار_تتر_دریافتی / مقدار_ارز if مقدار_ارز > 0 else 0

    if st.button("ثبت فروش"):
        st.success("✅ فروش ثبت شد")
        st.write(f"نام شخص: {نام_شخص}")
        st.write(f"تاریخ: {تاریخ}")
        st.write(f"ارز فروخته‌شده: {ارز_فروخته_شده}")
        st.write(f"مقدار ارز: {مقدار_ارز}")
        st.write(f"مقدار تتر دریافتی: {مقدار_تتر_دریافتی}")
        st.write(f"قیمت فروش هر واحد {ارز_فروخته_شده}: {قیمت_فروش:,.2f} USDT")

# فرم انتقال ارز
elif نوع_تراکنش == "انتقال":
    st.subheader("📤 انتقال ارز")
    نام_شخص = st.selectbox("نام شخص", افراد)
    تاریخ = st.date_input("تاریخ", value=date.today())
    ارز_انتقالی = st.selectbox("ارز انتقالی", ارزها[1:])
    مقدار_ارسال = st.number_input(f"مقدار {ارز_انتقالی} ارسال‌شده", min_value=0.0, format="%.8f")
    مقدار_دریافت = st.number_input(f"مقدار {ارز_انتقالی} دریافتی در کیف پول", min_value=0.0, format="%.8f")

    کارمزد_انتقال = مقدار_ارسال - مقدار_دریافت if مقدار_ارسال > 0 else 0

    if st.button("ثبت انتقال"):
        st.success("✅ انتقال ثبت شد")
        st.write(f"نام شخص: {نام_شخص}")
        st.write(f"تاریخ: {تاریخ}")
        st.write(f"ارز انتقالی: {ارز_انتقالی}")
        st.write(f"مقدار ارسال‌شده: {مقدار_ارسال}")
        st.write(f"مقدار دریافتی: {مقدار_دریافت}")
        st.write(f"کارمزد انتقال: {کارمزد_انتقال:.8f} {ارز_انتقالی}")

# فرم سواپ ارز دیجیتال
elif نوع_تراکنش == "سواپ":
    st.subheader("🔄 سواپ ارز دیجیتال")
    نام_شخص = st.selectbox("نام شخص", افراد)
    تاریخ = st.date_input("تاریخ", value=date.today())
    ارز_مبدأ = st.selectbox("ارز مبدأ", ارزها[2:])
    مقدار_ارز_مبدأ = st.number_input(f"مقدار {ارز_مبدأ} سواپ‌شده", min_value=0.0, format="%.8f")
    ارز_مقصد = st.selectbox("ارز مقصد", [ارز for ارز in ارزها[2:] if ارز != ارز_مبدأ])
    مقدار_ارز_مقصد = st.number_input(f"مقدار {ارز_مقصد} دریافتی", min_value=0.0, format="%.8f")

    قیمت_سواپ = مقدار_ارز_مبدأ / مقدار_ارز_مقصد if مقدار_ارز_مقصد > 0 else 0

    if st.button("ثبت سواپ"):
        st.success("✅ سواپ ثبت شد")
        st.write(f"نام شخص: {نام_شخص}")
        st.write(f"تاریخ: {تاریخ}")
        st.write(f"ارز مبدأ: {ارز_مبدأ}")
        st.write(f"مقدار سواپ‌شده: {مقدار_ارز_مبدأ}")
        st.write(f"ارز مقصد: {ارز_مقصد}")
        st.write(f"مقدار دریافتی: {مقدار_ارز_مقصد}")
        st.write(f"قیمت سواپ هر واحد {ارز_مقصد}: {قیمت_سواپ:,.4f} {ارز_مبدأ}")
