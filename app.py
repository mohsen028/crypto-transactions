import streamlit as st
import pandas as pd

st.set_page_config(page_title="مدیریت تراکنش‌های ارز دیجیتال", layout="wide")
st.title("📊 فرم ثبت تراکنش ارز دیجیتال")

# نرخ‌های لحظه‌ای فرضی
نرخ_فعلی = {
    "BTC": 54.11,
    "PAXG": 141.97,
    "USDT": 54.08
}

# فرم ورود اطلاعات
col1, col2 = st.columns(2)
with col1:
    نام_شخص = st.selectbox("نام شخص", ["hassan", "abbas", "shahla", "mohsen"])
    نوع_تراکنش = st.selectbox("نوع تراکنش", ["خرید", "فروش"])
    نام_ارز = st.selectbox("نام ارز", list(نرخ_فعلی.keys()))
    مقدار = st.number_input("مقدار ارز", min_value=0.0, format="%.8f")
    قیمت_واحد = st.number_input("قیمت واحد (تومان)", min_value=0.0)
with col2:
    کارمزد = st.number_input("کارمزد (تومان)", min_value=0.0)
    توضیحات = st.text_area("توضیحات")
    تاریخ = st.date_input("تاریخ تراکنش")

# محاسبات
کل_پرداختی = مقدار * قیمت_واحد + کارمزد
دریافتی = مقدار * نرخ_فعلی[نام_ارز] if نوع_تراکنش == "فروش" else 0
سود_ریالی = دریافتی - کل_پرداختی if نوع_تراکنش == "فروش" else 0
درصد_سود = (سود_ریالی / کل_پرداختی * 100) if کل_پرداختی > 0 else 0

# نمایش نتایج
if st.button("ثبت تراکنش"):
    st.success("✅ تراکنش ثبت شد")
    st.write("### جزئیات تراکنش:")
    st.write(f"نام شخص: {نام_شخص}")
    st.write(f"نوع تراکنش: {نوع_تراکنش}")
    st.write(f"نام ارز: {نام_ارز}")
    st.write(f"مقدار: {مقدار}")
    st.write(f"قیمت واحد: {قیمت_واحد} تومان")
    st.write(f"کل پرداختی: {کل_پرداختی:.2f} تومان")
    if نوع_تراکنش == "فروش":
        st.write(f"دریافتی: {دریافتی:.2f} تومان")
        st.write(f"سود/زیان ریالی: {سود_ریالی:.2f} تومان")
        st.write(f"درصد سود/زیان: {درصد_سود:.2f}%")
    st.write(f"توضیحات: {توضیحات}")
    st.write(f"تاریخ: {تاریخ}")

# جدول فرضی برای نمایش تراکنش‌ها (در آینده می‌تونه ذخیره بشه)
st.write("### 📋 جدول تراکنش‌ها (نمونه)")
df = pd.DataFrame([{
    "نام شخص": نام_شخص,
    "نوع تراکنش": نوع_تراکنش,
    "نام ارز": نام_ارز,
    "مقدار": مقدار,
    "قیمت واحد": قیمت_واحد,
    "کل پرداختی": کل_پرداختی,
    "دریافتی": دریافتی,
    "سود ریالی": سود_ریالی,
    "درصد سود": درصد_سود,
    "توضیحات": توضیحات,
    "تاریخ": تاریخ
}])
st.dataframe(df)
